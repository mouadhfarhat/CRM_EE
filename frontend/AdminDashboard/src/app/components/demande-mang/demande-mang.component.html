<div class="hold-transition dark-mode sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed">
    <div class="wrapper">

<div class="content-wrapper">
  <section class="content-header">
    <div class="container-fluid">
      <div class="row mb-2">
        <div class="col-sm-6"><h1>Demandes</h1></div>
        <div class="col-sm-6">
          <ol class="breadcrumb float-sm-right">
            <li class="breadcrumb-item"><a href="#">Accueil</a></li>
            <li class="breadcrumb-item active">Demandes</li>
          </ol>
        </div>
      </div>
    </div>
  </section>

<section class="content">
    <!-- Search Form -->
<div class="card-body">
  <form (submit)="searchDemandes(); $event.preventDefault()" class="form-inline mb-3">
    <input type="text" class="form-control mr-2 mb-2" placeholder="Titre" [(ngModel)]="searchTitle" name="title" />
    <input type="text" class="form-control mr-2 mb-2" placeholder="Description" [(ngModel)]="searchDescription" name="description" />
    <input type="text" class="form-control mr-2 mb-2" placeholder="Nom du client" [(ngModel)]="searchClientName" name="clientName" />
    
    <select class="form-control mr-2 mb-2" [(ngModel)]="searchStatut" name="statut">
      <option value="">Tous Statuts</option>
      <option *ngFor="let s of ['EN_ATTENTE', 'EN_COURS', 'REFUSE' , 'TERMINE']" [value]="s">{{ s }}</option>
    </select>

    <button type="submit" class="btn btn-primary mb-2">Rechercher</button>
  </form>
</div>

  <div class="card">
    <div class="card-header">
      <h3 class="card-title">Demandes Assignées</h3>
    </div>
    <div class="card-body p-0">
      <div style="max-height: 550px; overflow-y: auto;">
        <table class="table table-striped projects">
          <thead>
            <tr>
              <th style="width: 5%">#</th>
              <th style="width: 20%">Titre</th>
              <th style="width: 25%">Gestionnaire</th>
              <th style="width: 20%">Client</th>
              <th style="width: 15%">Statut & Type</th>
              <th style="width: 15%"></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let demande of demandes; let i = index">
              <td>{{ i + 1 }}</td>

              <td>
                <a [routerLink]="['/mail/read', demande.id]">{{ demande.title }}</a>
                <small>Formation: {{ demande.formation!.title || 'N/A' }}</small>
              </td>

              <!-- Gestionnaire & Shared With Column -->
              <td>
                <ul class="list-inline">
                  <li class="list-inline-item">
                    <img
                      *ngIf="demande.gestionnaireAssigne?.keycloakId"
                      [src]="gestionnaireImageMap[demande.gestionnaireAssigne.keycloakId!]"
                      alt="Image"
                      class="table-avatar"
                      style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;"
                    />
                  </li>
                  <li class="list-inline-item">
                    <strong>Gestionnaire:</strong>
                    <a
                      *ngIf="demande.gestionnaireAssigne"
                      [routerLink]="['/profile', demande.gestionnaireAssigne.id]"
                    >
                      {{ demande.gestionnaireAssigne.username }}
                    </a>
                    <span *ngIf="!demande.gestionnaireAssigne">N/A</span><br />

                    <ng-container *ngIf="demande.sharedWith">
                      <strong>Partagée avec:</strong>
                      <a [routerLink]="['/profile', demande.sharedWith.id]">
                        {{ demande.sharedWith.username }}
                      </a>
                    </ng-container>
                  </li>
                </ul>
              </td>

              <!-- Client Column -->
              <td>
                <a *ngIf="demande.client" [routerLink]="['/profile', demande.client.id]">
                  {{ demande.client.username }}
                </a>
                <span *ngIf="!demande.client">N/A</span>
              </td>

              <td>
                <span class="badge badge-info">{{ demande.statut }}</span><br />
                <span class="badge badge-secondary mt-1">{{ demande.type }}</span>
              </td>

              <td class="project-actions text-right">
                <button class="btn btn-danger btn-sm" (click)="deleteDemande(demande.id)">
                  <i class="fas fa-trash"></i> Supprimer
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>

</div>

</div>
</div>