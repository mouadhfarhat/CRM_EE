<div class="hold-transition dark-mode sidebar-mini layout-fixed layout-navbar-fixed layout-sidebar-fixed layout-footer-fixed">
  <div class="wrapper">
    <!-- Content Wrapper -->
    <div class="content-wrapper">
      <!-- Page Header -->
      <app-carousel
        (categorySelected)="onCategorySelected($event)"
        (searchTermChanged)="onSearchTermChanged($event)"
        (sortOptionChanged)="onSortOptionChanged($event)"
      ></app-carousel>

      <!-- Main Content -->
<section class="content">
  <div class="container-fluid">
    <div class="formation-carousel-wrapper">
      <div class="formation-carousel">
        <div class="formation-card" *ngFor="let item of formations">
          <div class="p-6 border-round-lg shadow-4 surface-card h-full flex flex-column justify-between gap-4 hover:shadow-6 transition-all">
            <!-- Image -->
            <div class="flex justify-content-center">
              <img
                [src]="imageUrls[item.id!] || 'assets/placeholder.png'"
                [alt]="item.title"
                class="rounded w-full"
                style="max-height: 180px; object-fit: cover; background: #1f1f1f;" />
            </div>

            <!-- Info -->
            <div class="flex flex-column gap-2">
              <h3 class="text-xl font-bold text-white leading-snug">{{ item.title }}</h3>
              <p class="text-sm text-gray-400 truncate-3-lines">{{ item.description }}</p>

              <div class="text-xs text-gray-500 mt-2 space-y-1.5">
                <div><i class="pi pi-calendar mr-1"></i>Du {{ item.dateDebut | date: 'mediumDate' }} au {{ item.dateFin | date: 'mediumDate' }}</div>
                <div><i class="pi pi-clock mr-1"></i>Inscription avant le {{ item.registrationEndDate | date: 'mediumDate' }}</div>
                <div><i class="pi pi-user mr-1"></i>{{ item.formateur?.firstname || 'N/A' }} {{ item.formateur?.lastname || '' }}</div>
                <div><i class="pi pi-briefcase mr-1"></i>{{ item.foodCompany?.name || 'Rayan Food' }}</div>
              </div>
            </div>

            <!-- Rating & Price -->
            <div class="flex justify-between items-center mt-3">
              <div class="flex items-center gap-1 text-sm">
                <span class="text-white font-medium">{{ item.rating ?? item.averageRating ?? '0' }}</span>
                <i class="pi pi-star-fill text-yellow-500"></i>
              </div>
              <span class="text-green-400 font-semibold text-base">{{ item.price | currency:'EUR' }}</span>
            </div>

            <!-- Actions -->
            <div class="flex justify-between items-center mt-4 gap-3 flex-wrap">
              <p-button
                size="small"
                [icon]="isInterested(item.id!) ? 'pi pi-heart-fill' : 'pi pi-heart'"
                [severity]="isInterested(item.id!) ? 'danger' : 'secondary'"
                [outlined]="false"
                pTooltip="Marquer comme intéressé"
                (onClick)="toggleInterest(item.id!)">
              </p-button>
<p-button
 class="demande-btn"
  [ngClass]="{ 'disabled-btn': isRegistrationClosed(item.registrationEndDate) }"
  size="small"
  icon="pi pi-envelope"
  label="Faire une demande"
  [routerLink]="['/composeMail']"
  [queryParams]="{ clientId: clientId, formationId: item.id }"
  *ngIf="clientId"
  [disabled]="isRegistrationClosed(item.registrationEndDate)"
  [style.backgroundColor]="isRegistrationClosed(item.registrationEndDate) ? '#ccc' : ''"
  [style.color]="isRegistrationClosed(item.registrationEndDate) ? '#666' : ''"
>
</p-button>



              <a
  *ngIf="item.fileName"
  (click)="downloadFile(item.fileName)"
  class="download-link cursor-pointer text-blue-500 hover:underline flex items-center gap-1"
>
  <i class="pi pi-download"></i> PDF
</a>

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>



    </div>
  </div>
</div>