<div class="hold-transition dark-mode sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed">

<div class="wrapper">

      <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
      
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1>Clients</h1>
          </div>
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
              <li class="breadcrumb-item"><a href="#">Home</a></li>
              <li class="breadcrumb-item active">Clients</li>
            </ol>
          </div>
        </div>
      </div><!-- /.container-fluid -->
    </section>

    <!-- Main content -->
    <section class="content">

      <!-- Default box -->
      <div class="card card-solid">
        <div class="card-body pb-0">

            <!--search-->

        <!-- Search Section -->
<div class="row mb-3">
  <!-- Formation Title Search -->
  <div class="col-md-4 position-relative">
    <input
      [(ngModel)]="formationSearchTerm"
      (input)="onFormationSearch()"
      type="text"
      class="form-control"
      placeholder="Search Formation by Title"
      autocomplete="off"
    />

    <!-- Fancy Formation Dropdown -->
    <ul 
      *ngIf="showFormationDropdown && filteredFormations.length > 0" 
      class="list-group position-absolute w-100 z-3"
    >
      <li 
        class="list-group-item list-group-item-action"
        *ngFor="let formation of filteredFormations"
        (click)="selectFormation(formation)"
        style="cursor: pointer;"
      >
        {{ formation.title }}
      </li>
    </ul>
  </div>

  <!-- Group Dropdown Search -->
  <div class="col-md-4 position-relative">
    <input
      [(ngModel)]="groupSearchTerm"
      (focus)="toggleGroupDropdown()"
      type="text"
      class="form-control"
      placeholder="Search Group by Name"
      readonly
    />

    <!-- Fancy Group Dropdown -->
    <ul 
      *ngIf="showGroupDropdown && groups.length > 0"
      class="list-group position-absolute w-100 z-3"
    >
      <li 
        class="list-group-item list-group-item-action"
        *ngFor="let group of groups"
        (click)="selectGroup(group)"
        style="cursor: pointer;"
      >
        {{ group.name }}
      </li>
    </ul>
  </div>
  <button *ngIf="selectedFormationId" class="btn btn-sm btn-outline-secondary ms-2" (click)="selectFormation(null)">
  Clear
</button>


  <!-- Search Button -->
  <div class="col-md-4 d-flex align-items-end">
    <button class="btn btn-primary w-100" (click)="searchClients()">
      <i class="fas fa-search"></i> Search
    </button>
  </div>
</div>




        <!--the bulk message -->
          <div class="mb-3 d-flex justify-content-end" *ngIf="selectedClients.length > 0">
            <button class="btn btn-success mr-2" (click)="sendBulkEmail()">
              <i class="fas fa-envelope"></i> Email Selected ({{ selectedClients.length }})
            </button>
            <button class="btn btn-warning" (click)="sendBulkSMS()">
              <i class="fas fa-sms"></i> SMS Selected ({{ selectedClients.length }})
            </button>

          </div>
        <!--/.the bulk message -->

  
              
        <!--the client-->
<div class="row">
<div class="col-12 col-sm-6 col-md-4 d-flex align-items-stretch flex-column" *ngFor="let client of paginatedClients">
    <div class="card bg-light d-flex flex-fill shadow-sm">
      <div class="card-body pt-3">
        <div class="row">
          <div class="col-8">
            <h2 class="lead mb-2">
              <i class="fas fa-user-circle text-primary mr-1"></i>
              <b>{{ client.firstname }} {{ client.lastname }}</b>
            </h2>

            <p class="text-muted text-sm mb-1">
              <i class="fas fa-envelope text-success mr-2"></i>
              <b>Email:</b> {{ client.email }}
            </p>

            <p class="text-muted text-sm mb-1">
              <i class="fas fa-phone-alt text-warning mr-2"></i>
              <b>Phone:</b> {{ client.phoneNumber }}
            </p>

            <!-- Interested Formations Dropdown -->
            <div class="dropdown">
              <button class="btn btn-sm btn-outline-secondary dropdown-toggle mt-2" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                Interested In
              </button>
              <ul class="dropdown-menu">
                <li *ngIf="!client.interested || client.interested.length === 0" class="dropdown-item text-muted">
                  No interests listed
                </li>
                <li *ngFor="let interest of client.interested" class="dropdown-item">
                  {{ interest.title }}
                </li>
              </ul>
            </div>
          </div>

          <div class="col-4 text-center d-flex justify-content-center align-items-start">
            <img 
              [src]="getClientImage(client)" 
              alt="user-avatar" 
              class="img-fluid rounded-circle border shadow"
              style="width: 100px; height: 100px; object-fit: cover;"
            >
          </div>
        </div>
      </div>

      <div class="card-footer d-flex justify-content-between align-items-center">
        <!-- Select Checkbox -->
        <div class="form-check m-0">
          <input 
            class="form-check-input"
            type="checkbox"
            [(ngModel)]="client.selected"
            (change)="onClientSelectionChange()"
            id="select-{{client.id}}"
          >
          <label class="form-check-label text-muted small" for="select-{{client.id}}">
            Select
          </label>
        </div>

        <!-- Action Buttons -->
        <div class="btn-group">
          <button class="btn btn-sm btn-success" (click)="sendEmailToClient(client)" title="Send Email">
            <i class="fas fa-envelope"></i>
          </button>

<button class="btn btn-sm btn-warning text-white" (click)="openSmsModal(client)" title="Send SMS">
  <i class="fas fa-sms"></i>
</button>


          <a class="btn btn-sm btn-primary" routerLink="/profile" title="View Profile">
            <i class="fas fa-user"></i>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>


          <!--/end of client-->
        </div>
        <!-- /.card-body -->
<div class="card-footer">
  <nav aria-label="Contacts Page Navigation">
    <ul class="pagination justify-content-center m-0">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <a class="page-link" (click)="prevPage()">«</a>
      </li>

      <li
        class="page-item"
        *ngFor="let page of [].constructor(totalPages); let i = index"
        [class.active]="currentPage === i + 1"
      >
        <a class="page-link" (click)="goToPage(i + 1)">{{ i + 1 }}</a>
      </li>

      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <a class="page-link" (click)="nextPage()">»</a>
      </li>
    </ul>
  </nav>
</div>

        <!-- /.card-footer -->
      </div>
      <!-- /.card -->

    </section>
    <!-- /.content -->
  </div>

  <!-- /.content-wrapper -->

<!-- Compose Email Modal -->
<div *ngIf="isComposeModalVisible" class="custom-modal-backdrop">
  <div class="custom-modal">
    <div class="modal-header">
      <h5 class="modal-title">Send Bulk Email</h5>
      <button type="button" (click)="closeModal()">×</button>
    </div>
    <div class="modal-body">
      <form #emailForm="ngForm">
        <div class="form-group">
          <label>To:</label>
          <input type="text" class="form-control" [value]="selectedEmails" readonly>
        </div>
        <div class="form-group">
          <label>Subject:</label>
          <input type="text" class="form-control" [(ngModel)]="emailSubject" name="subject" required>
        </div>
        <div class="form-group">
          <label>Message:</label>
          <textarea class="form-control" rows="5" [(ngModel)]="emailBody" name="body" required></textarea>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeModal()">Cancel</button>
      <button class="btn btn-primary" (click)="sendEmailToSelected()">Send Email</button>
    </div>
  </div>
</div>



<!-- Custom Angular SMS Modal -->
<!-- SMS Modal -->
<div *ngIf="showSmsModal" class="sms-modal-overlay">
  <div class="sms-modal-content">
    <h3>Envoyer un SMS</h3>
    <p><strong>Client :</strong> {{ selectedClient?.firstName }} ({{ selectedClient?.phoneNumber }})</p>

    <textarea [(ngModel)]="customMessage" rows="5" class="sms-textarea" placeholder="Tapez votre message ici..."></textarea>

    <div class="sms-modal-actions">
      <button class="btn btn-success" (click)="sendCustomSms()">Envoyer</button>
      <button class="btn btn-secondary" (click)="closeSmsModal()">Annuler</button>
    </div>
  </div>
</div>










</div>
</div>